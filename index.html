<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-History: Achievement Challenge</title>
    <style>
        :root { --green: #27ae60; --yellow: #f1c40f; --red: #e74c3c; --blue: #3498db; --bg: #f0f2f5; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; }
        #game-container { background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 650px; text-align: center; }
        
        .passage-card { background: white; border: 1px solid #ced4da; padding: 15px; border-radius: 8px; text-align: left; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; line-height: 1.5; font-size: 1rem; }
        .confirmed { margin-bottom: 12px; cursor: pointer; transition: 0.2s; }
        .confirmed.abbreviated { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-height: 48px; }
        
        .timeline-slot { height: 20px; background: #e9ecef; margin: 10px 0; border-radius: 8px; border: 2px dashed #ced4da; }
        .timeline-slot.drag-over { background: #d1e7dd; border-color: var(--green); height: 60px; }

        #drag-me { background: #fff3cd; border: 2px solid #ffc107; cursor: grab; font-style: italic; margin-bottom: 15px; }
        .source-tag { font-weight: bold; font-size: 0.75rem; color: #555; text-transform: uppercase; margin-right: 5px; }
        
        .state-correct { border-left: 6px solid var(--green); background: #f8fff9; }
        .state-clue { border-left: 6px solid var(--yellow); background: #fffdf0; }
        .state-wrong { border-left: 6px solid var(--red); background: #fff5f5; }
        .state-anchor { border-left: 6px solid var(--blue); background: #f0f7ff; }

        .hidden { display: none !important; }
        .btn { padding: 12px 24px; border: none; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 1rem; width: 100%; transition: 0.2s; }
        .btn-start { background: var(--blue); color: white; }
        .btn-hint { background: #e67e22; color: white; margin-top: 10px; display: block; }
        .btn-next { background: var(--green); color: white; margin-top: 15px; }

        #score-display { font-size: 1.2rem; font-weight: bold; padding: 10px; background: #eef2f7; border-radius: 8px; margin-bottom: 15px; border: 1px solid #d0d7de; }
        #explanation-area { padding: 15px; border-radius: 8px; margin-top: 10px; text-align: left; font-size: 0.95rem; border: 1px solid #ddd; }
        
        .achievement-box { background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 12px; padding: 20px; margin-bottom: 25px; text-align: left; }
        .stat-line { margin: 8px 0; font-size: 0.95rem; display: flex; justify-content: space-between; }
        .rank-title { font-size: 1.5rem; font-weight: 800; color: var(--blue); margin-bottom: 10px; text-transform: uppercase; }
        
        .significance-text { margin-top: 10px; font-size: 0.88rem; color: #444; border-top: 1px solid #eee; padding-top: 8px; font-style: normal; }
    </style>
</head>
<body>

<div id="game-container">
    <h1 style="margin:0 0 10px 0;">Eco-History Challenge</h1>
    <div id="score-display" class="hidden">Score: <span id="correct-count">0</span> / 100</div>

    <div id="start-screen">
        <p>Correct order (No Clue) = 20 pts | With Clue = 10 pts</p>
        <button class="btn btn-start" onclick="startGame()">Begin Game</button>
    </div>

    <div id="game-ui" class="hidden">
        <div id="instruction-text" style="font-weight:600; margin-bottom:15px; color:#2c3e50;"></div>
        <div id="new-challenge-container">
            <div id="drag-me" class="passage-card" draggable="true">
                <span id="challenge-text"></span>
            </div>
            <div id="hint-area">
                <button id="hint-btn" class="btn btn-hint" onclick="revealHint()">Get a Clue (-10 pts)</button>
                <div id="hint-box" class="hidden" style="background:#fff3cd; padding:12px; border-radius:8px; margin-top:5px; font-size:0.9rem; color:#856404; font-weight:bold; text-align:left;"></div>
            </div>
            <div id="post-guess-feedback" class="hidden">
                <div id="explanation-area"></div>
                <button class="btn btn-next" onclick="proceedToNext()">Continue to Next Stage</button>
            </div>
        </div>
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        <div id="timeline-area"></div>
    </div>

    <div id="final-screen" class="hidden">
        <div id="achievement-report"></div>
        <p>Would you like to try another sequence of discoveries?</p>
        <button class="btn btn-start" onclick="location.reload()">Play Again</button>
    </div>
</div>

<script>
    const allPassages = [
        { year: -2100, source: "Gilgamesh", text: "The heroes took their axes and penetrated into the depths of the Cedar Forest, where the mountain was green and the shade was cool. When they cut down the sacred cedar, the guardian Humbaba was slain, and the god Enlil was filled with fury at the destruction of his trees. The epic records that the heavens roared and the earth echoed back a reply as the mountain was stripped bare.", hint: "A time when the first city-states emerged from the Bronze Age.", reason: "The Epic records the earliest literary tension between city-building and wilderness.", significance: "This represents the dawn of anthropocentrism. It captures the moment humanity began to view the natural world not just as a home, but as a resource to be harvested for urban glory, prompting divine (ecological) anxiety." },
        { year: -300, source: "Mencius", text: "The trees of the Ox Mountain were once beautiful, but because they were on the outskirts of a great state, they were hewn down with axes and bills until only the bare earth remained. Seeing it so denuded, people now imagine the mountain was never finely wooded, assuming a heartless man never possessed virtue. If it receives proper nourishment, there is nothing which will not grow; if it loses it, decay is inevitable.", hint: "When scholars in East Asia first debated how the environment reflects human virtue.", reason: "Mencius (4th c. BCE) used this ecology-to-ethics metaphor to argue for the innate goodness of human nature.", significance: "Mencius establishes the 'Moral Ecology' framework. He argues that the degradation of the environment is a direct mirror of the degradation of the human soul; to nourish one is to nourish the other." },
        { year: 950, source: "Brethren of Purity", text: "The animals gathered to bring a legal case against the human race for their cruelty, arguing that humans had seized their lands and claimed they were masters. Humans disrupted the sacred balance of the world set in harmony by the Creator. Arrogance toward the natural world will lead to a shared ruin for both man and beast.", hint: "A period of scientific debate in the medieval Islamic world.", reason: "The 'Case of the Animals' is a medieval Islamic critique of human claims to absolute dominion over nature.", significance: "This text provides a medieval Arabic foundation for animal rights and ecological balance (Mizan). It challenges the idea that humans have an absolute right to exploit nature, insisting that humans are but one part of a divine harmony." },
        { year: 1669, source: "Colbert", text: "France will surely perish for lack of wood if we do not intervene to stop the destruction of our kingdom's forests. This Great Ordinance is enacted to ensure timber is preserved for the royal navy and the survival of the state. We must treat woodlands as a national treasure requiring the constant care of the sovereign.", hint: "The era of mercantilism, when monarchs built fleets for global trade.", reason: "Colbert's 1669 Ordinance founded state forestry to secure timber for warships.", significance: "This marks the birth of State-Managed Forestry. It shifts environmental concern from a moral issue to a matter of national security and economic survival, laying the groundwork for modern resource management." },
        { year: 1712, source: "Ekken", text: "Plants, birds, and beasts are all children of nature just as humans are, sharing the same vital life-force of the universe. A ruler who destroys forests for luxury is like a foolish man who cuts off his own limbs to feed his belly. Treating nature with cruelty is a violation of the filial piety we owe to the earth that sustains us.", hint: "When thinkers blended social duties with botany during regional isolation.", reason: "Ekken applied the concept of 'Qi' to environmental duty during the Japanese Edo period.", significance: "Ekken integrates Neo-Confucian social ethics with biological study. He frames the environment as an extension of the family unit, making ecological care a requirement of 'filial piety' rather than just a practical choice." },
        { year: 1798, source: "Malthus", text: "The power of population is so superior to the power of the earth to produce subsistence for man that premature death must visit the human race. Vices of mankind are active ministers of depopulation, serving as precursors in the army of destruction. Sickly seasons, epidemics, and plague advance to sweep off their thousands.", hint: "When rapid urban growth first sparked fears of global famine.", reason: "Malthus established the 'Malthusian Trap' at the dawn of the Industrial Revolution.", significance: "Malthus introduced the concept of 'Carrying Capacity.' He was the first to mathematically model the hard limits of the Earth's resources, starting a debate on overpopulation that continues to this day." },
        { year: 1808, source: "Fourier", text: "Civilization brings the axe and destruction to the natural world, resulting in the denuding of mountain-sides and a permanent deterioration of the climate. We boast of our progress while falling far below the savages who at least leave the land in its primitive state. In fifty years, we will discover that our current jargon of perfectibility was actually environmental ruin.", hint: "When social theorists first argued that clearing forests was changing weather patterns.", reason: "Fourier was among the first to argue that deforestation caused regional climate shifts.", significance: "Fourier offers an early critique of industrial 'progress.' He is one of the first to explicitly link human industrial activity (logging) to regional climate change, warning that technical advancement might lead to ecological collapse." },
        { year: 1830, source: "Humboldt", text: "When forests are destroyed with such imprudent precipitance, the natural springs are dried up and the rivers become mere torrents during the rains. The atmosphere loses its obstacle to the sun's heat, causing the ground to bake and the local climate to shift. We must view nature as a single living whole where every organism and element is linked.", hint: "A global explorer who mapped the 'web of life' across the tropics.", reason: "Humboldt's early 19th-century travels laid the scientific foundation for ecology.", significance: "Humboldt founded modern Ecology. By viewing nature as a 'Web of Life,' he proved that damaging one part of an ecosystem (the trees) has cascading effects on the water cycle, soil, and global atmosphere." },
        { year: 1864, source: "Marsh", text: "Man is everywhere a disturbing agent; wherever he plants his foot, the harmonies of nature are turned into discords. Indigenous species are extirpated and supplanted by foreign growths, while the face of the earth is laid bare to the elements. Without the forest, the soil is parched by summer sun and seared by the rigors of winter.", hint: "When diplomats first systematically documented the scars of rapid modern expansion.", reason: "Marsh's 'Man and Nature' documented how human activity permanently alters the Earth.", significance: "Marsh's 'Man and Nature' is the first systematic proof of human impact on a planetary scale. He moved environmentalism from observation to warning, showing that humans could unintentionally cause the collapse of civilizations by ruining their soil and water." },
        { year: 1869, source: "Ottoman Code", text: "The forests are henceforth declared common property of the State; no person shall clear forest land for private agriculture without permission. The protection of mountains prevents the silting of our rivers and the drying of our plains. We must centralize management to ensure the ecological stability of the imperial landscape.", hint: "A period of reform where empires modernized laws to protect watersheds.", reason: "This 1869 code represents the spread of centralized, state-run environmental management.", significance: "The 1869 regulation shows that conservation was a global phenomenon. It illustrates how empires outside the West adopted scientific management to protect the 'hydraulic stability' of their lands to prevent agricultural ruin." },
        { year: 1881, source: "Wilber", text: "The Creator never imposed a perpetual desert upon the earth. By the industry and skill of man, even the most unpromising arid lands can be transformed by the plow into fertile fields. It is a grand concert of forces where human energy compels the heavens to yield their treasures of dew and rain.", hint: "When frontier settlers believed plowing land created rain.", reason: "Land promoters used the myth 'Rain Follows the Plow' to encourage Western settlement.", significance: "Wilber represents 'Ecological Hubris.' His work illustrates the 19th-century belief that human technology could physically engineer the climate for profit, a dangerous myth that led to the Dust Bowl era." },
        { year: 1912, source: "Muir", text: "Dam Hetch Hetchy! One might as well dam the people's cathedrals and churches for water-tanks, for no holier temple has ever been consecrated. These temple-destroyers, devotees of a ravaging commercialism, have a perfect contempt for Nature. The valley is not a commodity, but a spiritual resource.", hint: "When the battle between 'spiritual nature' and 'urban progress' began.", reason: "Muir defined preservationism, valuing nature for its intrinsic spiritual worth.", significance: "Muir defined the 'Preservationist' movement. He shifted the environmental argument from 'resource management' to 'spiritual necessity,' arguing that wilderness is vital for the human soul, not just the human economy." },
        { year: 1938, source: "Callendar", text: "The combustion of fossil fuel is likely to prove beneficial to mankind by delaying the return of deadly glaciers. These small increases in mean temperature will be important for northern cultivation, as the growth of plants is proportional to carbon dioxide pressure. Returning carbon to the air is a grand experiment.", hint: "The first scientific link between coal smoke and a warmer planet.", reason: "In 1938, Callendar provided the first data linking CO2 to warming.", significance: "Callendar discovered the 'Callendar Effect'—the first quantitative proof that fossil fuel burning was raising global temperatures. Ironically, he initially believed this warming would be a positive 'grand experiment' to improve agriculture." },
        { year: 1962, source: "Carson", text: "For the first time in history, every human being is now subjected to contact with dangerous chemicals from conception until death. These synthetic pesticides linger in the soil and even the bodies of fish and birds. We have allowed these 'elixirs of death' to be used without understanding the long-term consequences.", hint: "When the threat of synthetic industrial chemicals first reached the public.", reason: "Carson transformed environmentalism into a movement focused on toxic pollutants.", significance: "Carson's 'Silent Spring' shifted the focus from 'saving trees' to 'toxicology.' She proved that industrial chemicals were poisoning the entire food chain, including humans, launching the modern environmental movement." },
        { year: 1975, source: "Fukuoka", text: "The ultimate goal of farming is not the growing of crops, but the cultivation and perfection of human beings. Humanity, with its specialized sciences, has only created a world of confusion by trying to 'improve' what was already perfect. By practicing 'do-nothing' farming, we allow the earth to restore its own health.", hint: "A move back to traditional soil wisdom after the postwar industrial boom.", reason: "Fukuoka advocated for a return to minimal-intervention agriculture in 1975.", significance: "Fukuoka offered a radical critique of the 'Green Revolution.' He argued for 'Do-Nothing Farming,' a return to biological processes that restores the Earth rather than exhausting it with chemical fertilizers." },
        { year: 1988, source: "Hansen", text: "The expected global warming is now of the same magnitude as the observed warming. Our data suggest a cooling in the stratosphere while the ground is warming, a clear signature of the greenhouse effect. We can state with ninety-nine percent confidence that the greenhouse effect has been detected.", hint: "When computing confirmed the global greenhouse signal was already here.", reason: "Hansen's testimony made Climate Change a dominant political priority in 1988.", significance: "Hansen's 1988 Senate testimony marks the moment Global Warming became a political reality. He provided the statistical confidence needed to move climate change from a scientific theory to a global policy crisis." },
        { year: 1989, source: "Shiva", text: "The colonial divide separated forest from farm and removed indigenous people from their lands in the name of fragmented science. This Western patriarchal reason imposes a logic of monoculture against the cyclic flows of ecology. We must reclaim the partnership between women and nature to ensure sustenance.", hint: "A voice from the Global South challenging industrial ownership of life.", reason: "In the late 80s, Shiva led the push against industrial 'patenting' of nature.", significance: "Vandana Shiva introduces 'Ecofeminism' and anti-colonial ecology. She argues that industrial agriculture treats life as private property (patents), destroying the biodiversity and local wisdom that sustain global life." },
        { year: 2004, source: "Maathai", text: "We are called to assist the Earth to heal her wounds and, in the process, we will heal our own wounds as we recognize that sustainable development and peace are indivisible. Planting trees is a simple act, but it creates a movement for democracy and allows the soil to hold the water.", hint: "When environmental restoration was linked directly to democratic peace.", reason: "Maathai's Green Belt Movement linked environmental healing with political democracy.", significance: "Maathai linked Ecology with Democracy. Her Green Belt Movement showed that restoring the environment (planting trees) is a direct tool for empowering poor communities and ensuring long-term political peace." }
    ];

    let gameDeck = [], placedTimeline = [], currentStep = 0, score = 0, cluesUsedCount = 0, currentHintUsed = false, correctCount = 0;

    function startGame() {
        gameDeck = allPassages.sort(() => 0.5 - Math.random()).slice(0, 6);
        placedTimeline = [Object.assign({}, gameDeck[0], {status: 'anchor'})];
        currentStep = 1; score = 0; correctCount = 0; cluesUsedCount = 0;
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('score-display').classList.remove('hidden');
        document.getElementById('game-ui').classList.remove('hidden');
        renderTimeline();
        showNextChallenge();
    }

    function renderTimeline() {
        const area = document.getElementById('timeline-area');
        area.innerHTML = "";
        createSlot(area, 0);
        placedTimeline.forEach((p, index) => {
            const card = document.createElement('div');
            const isInitialAnchor = (p.status === 'anchor' && currentStep === 1);
            card.className = "passage-card confirmed " + getStatusClass(p.status) + (isInitialAnchor ? "" : " abbreviated");
            const dateStr = p.year < 0 ? Math.abs(p.year) + " BCE" : p.year;
            card.innerHTML = `<span class="source-tag">${dateStr} — ${p.source}:</span> ${p.text}`;
            card.onclick = () => card.classList.toggle('abbreviated');
            area.appendChild(card);
            createSlot(area, index + 1);
        });
        document.getElementById('correct-count').innerText = score;
    }

    function getStatusClass(s) {
        if (s === 'correct') return 'state-correct';
        if (s === 'clue') return 'state-clue';
        if (s === 'wrong') return 'state-wrong';
        return 'state-anchor';
    }

    function createSlot(container, position) {
        const slot = document.createElement('div');
        slot.className = "timeline-slot";
        slot.addEventListener('dragover', (e) => { e.preventDefault(); slot.classList.add('drag-over'); });
        slot.addEventListener('dragleave', () => slot.classList.remove('drag-over'));
        slot.addEventListener('drop', (e) => { e.preventDefault(); slot.classList.remove('drag-over'); handleDrop(position); });
        container.appendChild(slot);
    }

    function showNextChallenge() {
        currentHintUsed = false;
        document.getElementById('challenge-text').innerText = gameDeck[currentStep].text;
        document.getElementById('hint-btn').classList.remove('hidden');
        document.getElementById('hint-box').classList.add('hidden');
        document.getElementById('hint-area').classList.remove('hidden');
        document.getElementById('post-guess-feedback').classList.add('hidden');
        document.getElementById('drag-me').classList.remove('hidden');
        document.getElementById('instruction-text').innerHTML = currentStep === 1 ? "Drag the new discovery below into the slot <strong>before</strong> or <strong>after</strong> the anchor." : "Place this discovery into the correct chronological slot.";
    }

    function revealHint() {
        currentHintUsed = true;
        cluesUsedCount++;
        const box = document.getElementById('hint-box');
        box.innerText = "CLUE: " + gameDeck[currentStep].hint;
        box.classList.remove('hidden');
        document.getElementById('hint-btn').classList.add('hidden');
    }

    function handleDrop(userPos) {
        const nextData = gameDeck[currentStep];
        let correctPos = 0;
        while(correctPos < placedTimeline.length && nextData.year > placedTimeline[correctPos].year) correctPos++;
        const isCorrect = (userPos === correctPos);
        if (isCorrect) { score += currentHintUsed ? 10 : 20; correctCount++; }
        const status = isCorrect ? (currentHintUsed ? 'clue' : 'correct') : 'wrong';
        const feedback = document.getElementById('explanation-area');
        feedback.innerHTML = `<strong>${isCorrect ? "✓ Correct!" : "✘ Incorrect."}</strong><br>${nextData.reason}`;
        feedback.className = getStatusClass(status);
        placedTimeline.splice(correctPos, 0, Object.assign({}, nextData, {status: status}));
        renderTimeline();
        document.getElementById('drag-me').classList.add('hidden');
        document.getElementById('hint-area').classList.add('hidden');
        document.getElementById('post-guess-feedback').classList.remove('hidden');
    }

    function proceedToNext() {
        currentStep++;
        if (currentStep < 6) showNextChallenge();
        else summarizeAchievements();
    }

    function summarizeAchievements() {
        document.getElementById('game-ui').classList.add('hidden');
        document.getElementById('final-screen').classList.remove('hidden');
        let rank = score === 100 ? "Grand Archivist" : score >= 80 ? "Syllabus Master" : score >= 60 ? "Research Associate" : "Frontier Scout";
        const report = document.getElementById('achievement-report');
        report.innerHTML = `
            <div class="achievement-box">
                <div class="rank-title">${rank}</div>
                <div class="stat-line"><span>Final Score:</span> <strong>${score} / 100</strong></div>
                <div class="stat-line"><span>Strategic Profile:</span> <strong>${cluesUsedCount === 0 ? "Historical Intuition" : "Methodical Analyst"}</strong></div>
                <hr style="margin: 15px 0;">
                <p style="font-weight:bold; font-size:0.9rem;">Review of Environmental Significance:</p>
                <div id="final-review-list"></div>
            </div>`;
        const list = document.getElementById('final-review-list');
        placedTimeline.forEach(p => {
            const div = document.createElement('div');
            div.className = "passage-card confirmed " + getStatusClass(p.status);
            div.innerHTML = `<span class="source-tag">${p.year < 0 ? Math.abs(p.year) + " BCE" : p.year} — ${p.source}:</span> ${p.text}<div class="significance-text"><strong>Environmental Significance:</strong> ${p.significance}</div>`;
            list.appendChild(div);
        });
    }

    document.getElementById('drag-me').addEventListener('dragstart', (e) => e.dataTransfer.setData("text", "pass"));
</script>

</body>
</html>
